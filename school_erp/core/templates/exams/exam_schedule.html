{% extends "base/layout.html" %}
{% block content %}

<h1 class="text-xl font-semibold mb-6">Exam Schedule</h1>

<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <select id="class_id" class="form-control"></select>
    <select id="section_id" class="form-control"></select>
    <select id="subject_id" class="form-control"></select>
    <input type="date" id="exam_date" class="form-control">
</div>

<button id="addSchedule" class="bg-green-600 text-white px-4 py-2 rounded">
    Add Schedule
</button>

<table class="mt-6 w-full border">
    <thead>
        <tr class="bg-gray-100">
            <th class="p-2">Class</th>
            <th>Section</th>
            <th>Subject</th>
            <th>Date</th>
        </tr>
    </thead>
    <tbody id="scheduleTable"></tbody>
</table>

<script>
const examId = "{{ exam_id }}";
const token = "{{ request.session.auth.access_token }}";

async function loadDropdowns() {
    const [classes, sections, subjects] = await Promise.all([
        fetch("/api/classes").then(r => r.json()),
        fetch("/api/sections").then(r => r.json()),
        fetch("/api/subjects").then(r => r.json())
    ]);

    classes.forEach(c =>
        class_id.innerHTML += `<option value="${c.id}">${c.name}</option>`
    );
    sections.forEach(s =>
        section_id.innerHTML += `<option value="${s.id}">${s.name}</option>`
    );
    subjects.forEach(s =>
        subject_id.innerHTML += `<option value="${s.id}">${s.name}</option>`
    );
}

addSchedule.onclick = async () => {
    await fetch("https://erp.backend.smartbus360.com/exam-schedules", {
        method: "POST",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            exam_id: examId,
            class_id: class_id.value,
            section_id: section_id.value,
            subject_id: subject_id.value,
            exam_date: exam_date.value
        })
    });

    alert("Schedule added");
};

loadDropdowns();
</script>

{% endblock %}
